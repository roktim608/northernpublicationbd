{"version":3,"file":"google.js","sourceRoot":"","sources":["../../../src/store/checkout/google.ts"],"names":[],"mappings":"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","sourcesContent":["import { maybeConvertAmount } from '../../functions/currency';\nimport { LineItem, Product } from 'src/types';\n\n/**\n * Handle add to cart event.\n */\nwindow.addEventListener('scAddedToCart', function (e: CustomEvent) {\n  if (!window?.dataLayer && !window?.gtag) return;\n\n  // get the added item from the event.\n  const item: LineItem = e.detail;\n\n  // sanity check.\n  if (!item?.price?.product) return;\n\n  // create the items array.\n  const items = [\n    {\n      item_id: (item.price?.product as Product)?.id,\n      item_name: (item.price?.product as Product)?.name,\n      item_variant: (item.variant_options || []).join(' / '),\n      price: maybeConvertAmount(item?.price?.amount || 0, item.price?.currency || 'USD'),\n      currency: item.price?.currency,\n      quantity: item.quantity,\n      discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item.price?.currency || 'USD') : 0,\n    },\n  ];\n\n  // handle google analytics script\n  if (window?.gtag) {\n    window.gtag('event', 'add_to_cart', {\n      items,\n    });\n  }\n\n  // handle datalayer\n  if (window?.dataLayer) {\n    window.dataLayer.push({ ecommerce: null });\n    window.dataLayer.push({\n      event: 'add_to_cart',\n      ecommerce: {\n        data: {\n          items,\n        },\n      },\n    });\n  }\n});\n\n/**\n * Handle purchase complete event.\n */\nwindow.addEventListener('scCheckoutCompleted', function (e: CustomEvent) {\n  if (!window?.dataLayer && !window?.gtag) return;\n\n  const checkout = e.detail;\n\n  const data = {\n    transaction_id: checkout?.id,\n    value: maybeConvertAmount(checkout?.total_amount, checkout?.currency || 'USD'),\n    currency: (checkout.currency || '').toUpperCase(),\n    ...(checkout?.discount?.promotion?.code ? { coupon: checkout?.discount?.promotion?.code } : {}),\n    ...(checkout?.tax_amount ? { tax: maybeConvertAmount(checkout?.tax_amount, checkout?.currency || 'USD') } : {}),\n    items: (checkout?.line_items?.data || []).map(item => ({\n      item_id: (item?.price?.product as Product)?.id,\n      currency: (checkout.currency || '').toUpperCase(),\n      item_name: (item?.price?.product as Product)?.name || '',\n      discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item?.price?.currency || 'USD') : 0,\n      price: maybeConvertAmount(item?.price?.amount || 0, item?.price?.currency || 'USD'),\n      quantity: item?.quantity || 1,\n      item_variant: (item.variant_options || []).join(' / '),\n    })),\n  };\n\n  // handle gtag (analytics script.)\n  if (window?.gtag) {\n    window.gtag('event', 'purchase', data);\n  }\n\n  // handle dataLayer (google tag manager).\n  if (window?.dataLayer) {\n    window.dataLayer.push({ ecommerce: null }); // Clear the previous ecommerce object.\n    window.dataLayer.push({\n      event: 'purchase',\n      ecommerce: data,\n    });\n  }\n});\n"]}