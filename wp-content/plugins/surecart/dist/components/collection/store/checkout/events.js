import"../checkouts/events";import state,{on}from"./store";import{maybeConvertAmount}from"../../functions/currency";on("set",((t,n,o)=>{var i,u,e,l,d;if("checkout"!==t)return;if(null==o?void 0:o.id)return;if(!(null==n?void 0:n.id))return;if(!state.isCheckoutPage)return;const r=new CustomEvent("scCheckoutInitiated",{detail:{transaction_id:n.id,value:maybeConvertAmount(null==n?void 0:n.total_amount,(null==n?void 0:n.currency)||"USD"),currency:(n.currency||"").toUpperCase(),...(null===(u=null===(i=null==n?void 0:n.discount)||void 0===i?void 0:i.promotion)||void 0===u?void 0:u.code)?{coupon:null===(l=null===(e=null==n?void 0:n.discount)||void 0===e?void 0:e.promotion)||void 0===l?void 0:l.code}:{},...(null==n?void 0:n.tax_amount)?{tax:maybeConvertAmount(null==n?void 0:n.tax_amount,(null==n?void 0:n.currency)||"USD")}:{},items:((null===(d=null==n?void 0:n.line_items)||void 0===d?void 0:d.data)||[]).map((t=>{var o,i,u,e,l;return{item_name:(null===(i=null===(o=null==t?void 0:t.price)||void 0===o?void 0:o.product)||void 0===i?void 0:i.name)||"",item_id:null===(e=null===(u=null==t?void 0:t.price)||void 0===u?void 0:u.product)||void 0===e?void 0:e.id,discount:(null==t?void 0:t.discount_amount)?maybeConvertAmount((null==t?void 0:t.discount_amount)||0,(null==n?void 0:n.currency)||"USD"):0,price:maybeConvertAmount((null===(l=null==t?void 0:t.price)||void 0===l?void 0:l.amount)||0,(null==n?void 0:n.currency)||"USD"),quantity:(null==t?void 0:t.quantity)||1}}))},bubbles:!0});document.dispatchEvent(r)})),on("set",((t,n,o)=>{var i,u;if("checkout"!==t)return;if(!(null==n?void 0:n.status)||(null==o?void 0:o.status)===(null==n?void 0:n.status))return;if(!["paid","processing"].includes(n.status))return;const e=new CustomEvent("scOrderPaid",{detail:n,bubbles:!0});document.dispatchEvent(e);const l=new CustomEvent("scCheckoutCompleted",{detail:n,bubbles:!0});document.dispatchEvent(l);const d=((null===(i=null==n?void 0:n.line_items)||void 0===i?void 0:i.data)||[]).filter((t=>{var n;return(null===(n=null==t?void 0:t.price)||void 0===n?void 0:n.trial_duration_days)>0}));if(d.length>0){const t=new CustomEvent("scTrialStarted",{detail:d,bubbles:!0});document.dispatchEvent(t)}const r=((null===(u=null==n?void 0:n.line_items)||void 0===u?void 0:u.data)||[]).filter((t=>{var n;return(null===(n=null==t?void 0:t.price)||void 0===n?void 0:n.recurring_interval_count)>0}));if(r.length>0){const t=new CustomEvent("scSubscriptionStarted",{detail:r,bubbles:!0});document.dispatchEvent(t)}}));