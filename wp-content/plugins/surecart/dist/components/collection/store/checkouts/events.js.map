{"version":3,"file":"events.js","sourceRoot":"","sources":["../../../src/store/checkouts/events.ts"],"names":[],"mappings":"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","sourcesContent":["import { on } from './store';\nimport { Checkout, LineItem } from 'src/types';\n// import { maybeConvertAmount } from '../../functions/currency';\n\n// Listen to all stored checkouts and handle line item changes.\non('set', (_, value, oldValue) => Object.keys(value || {}).forEach(key => handleCheckoutLineItemChange(value[key] as Checkout, oldValue?.[key])));\n\n/**\n * Add to cart/remove from cart, cart updated events.\n */\nexport const handleCheckoutLineItemChange = (checkout: Checkout, oldCheckout: Checkout) => {\n  // get new and old line items.\n  const newLineItems = (checkout as Checkout)?.line_items?.data || [];\n  const oldLineItems = (oldCheckout as Checkout)?.line_items?.data || [];\n\n  // check for added items or quantity changed\n  newLineItems.forEach(newItem => {\n    const oldItem = oldLineItems.find(item => item.id === newItem.id);\n    // an item was added, or the quantity changed.\n    if (!oldItem || oldItem?.quantity < newItem?.quantity) {\n      const event = new CustomEvent<LineItem>('scAddedToCart', {\n        detail: {\n          ...newItem,\n          quantity: newItem.quantity - (oldItem?.quantity || 0),\n        },\n        bubbles: true,\n      });\n      document.dispatchEvent(event);\n    }\n  });\n\n  // check for removed items or quantity changed\n  oldLineItems.forEach(oldItem => {\n    const newItem = newLineItems.find(item => item.id === oldItem.id);\n    // an item was removed, or the quantity changed.\n    if (!newItem || oldItem?.quantity > newItem?.quantity) {\n      const event = new CustomEvent<LineItem>('scRemovedFromCart', {\n        detail: {\n          ...oldItem,\n          quantity: oldItem.quantity - (newItem?.quantity || 0),\n        },\n        bubbles: true,\n      });\n      document.dispatchEvent(event);\n    }\n  });\n\n  // check if line items have changed.\n  if (JSON.stringify(newLineItems) !== JSON.stringify(oldLineItems)) {\n    // emit an event here with the checkout state updates.\n    const event = new CustomEvent<[Checkout, Checkout]>('scCartUpdated', {\n      detail: [checkout, oldCheckout],\n      bubbles: true,\n    });\n    document.dispatchEvent(event);\n  }\n};\n"]}