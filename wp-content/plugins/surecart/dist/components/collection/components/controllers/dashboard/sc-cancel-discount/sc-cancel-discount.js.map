{"version":3,"file":"sc-cancel-discount.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/sc-cancel-discount/sc-cancel-discount.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,KAAK,EAAgB,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AAE/E,OAAO,EAAE,YAAY,EAAE,MAAM,gBAAgB,CAAC;AAE9C,OAAO,QAAQ,MAAM,6BAA6B,CAAC;AACnD,OAAO,EAAE,gBAAgB,EAAE,MAAM,6BAA6B,CAAC;AAE/D,OAAO,EAAE,aAAa,EAAE,MAAM,aAAa,CAAC;AAO5C,MAAM,OAAO,gBAAgB;;;;;;;;;EAU3B,aAAa,CAAC,MAAM;;IAClB,IAAI,CAAC,CAAA,MAAA,IAAI,CAAC,QAAQ,0CAAE,mBAAmB,CAAA,EAAE;MACvC,OAAO,MAAM,CAAC;KACf;IACD,OAAO,aAAa,CAAC,MAAM,EAAE,gBAAgB,CAAC,MAAA,IAAI,CAAC,QAAQ,0CAAE,mBAA6B,CAAC,CAAC,CAAC;EAC/F,CAAC;EAED,KAAK,CAAC,WAAW;;IACf,IAAI;MACF,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;MACpB,IAAI,CAAC,YAAY,GAAG,CAAC,MAAM,QAAQ,CAAC;QAClC,MAAM,EAAE,OAAO;QACf,IAAI,EAAE,YAAY,CAAC,6BAA6B,MAAA,IAAI,CAAC,YAAY,0CAAE,EAAE,WAAW,EAAE;UAChF,gBAAgB,EAAE;YAChB,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;YACpD,sBAAsB,EAAE,MAAA,IAAI,CAAC,MAAM,0CAAE,EAAE;WACxC;SACF,CAAC;OACH,CAAC,CAAiB,CAAC;MACpB,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;KACzB;IAAC,OAAO,CAAC,EAAE;MACV,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;MACjB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;KAChB;YAAS;MACR,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;KACtB;EACH,CAAC;EAED,MAAM;;IACJ,MAAM,EAAE,cAAc,EAAE,oBAAoB,EAAE,eAAe,EAAE,WAAW,EAAE,GAAG,CAAA,MAAA,IAAI,CAAC,QAAQ,0CAAE,oBAAoB,KAAI,EAAE,CAAC;IAEzH,OAAO,CACL,WAAK,KAAK,EAAC,iBAAiB;MAC1B,2BAAqB,OAAO,EAAE,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,EAAE,KAAK,EAAE,EAAE,+BAA+B,EAAE,KAAK,EAAE;QACjH,YAAM,IAAI,EAAC,aAAa,IAAE,IAAI,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAQ;QAC1E,eAAS,cAAc,EAAC,YAAY;UAClC,iBAAW,IAAI,EAAC,SAAS,EAAC,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,IACxD,eAAe,CACN;UACZ,iBAAW,KAAK,EAAC,6BAA6B,EAAC,IAAI,EAAC,MAAM,EAAC,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAC3F,WAAW,CACF,CACJ;QACT,CAAC,CAAC,IAAI,CAAC,OAAO,IAAI,mBAAa,OAAO,SAAG,CACtB,CAClB,CACP,CAAC;EACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Component, Event, EventEmitter, h, Prop, State } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\n\nimport apiFetch from '../../../../functions/fetch';\nimport { getHumanDiscount } from '../../../../functions/price';\nimport { CancellationReason, Coupon, ResponseError, Subscription, SubscriptionProtocol } from '../../../../types';\nimport { replaceAmount } from './functions';\n\n@Component({\n  tag: 'sc-cancel-discount',\n  styleUrl: 'sc-cancel-discount.scss',\n  shadow: true,\n})\nexport class ScCancelDiscount {\n  @Prop() subscription: Subscription;\n  @Prop() reason: CancellationReason;\n  @Prop() comment: string;\n  @Prop() protocol: SubscriptionProtocol;\n  @Event() scCancel: EventEmitter<void>;\n  @Event() scPreserved: EventEmitter<void>;\n  @State() loading: boolean;\n  @State() error: ResponseError;\n\n  replaceAmount(string) {\n    if (!this.protocol?.preservation_coupon) {\n      return string;\n    }\n    return replaceAmount(string, getHumanDiscount(this.protocol?.preservation_coupon as Coupon));\n  }\n\n  async addDiscount() {\n    try {\n      this.loading = true;\n      this.subscription = (await apiFetch({\n        method: 'PATCH',\n        path: addQueryArgs(`surecart/v1/subscriptions/${this.subscription?.id}/preserve`, {\n          cancellation_act: {\n            ...(!!this.comment ? { comment: this.comment } : {}),\n            cancellation_reason_id: this.reason?.id,\n          },\n        }),\n      })) as Subscription;\n      this.scPreserved.emit();\n    } catch (e) {\n      console.error(e);\n      this.error = e;\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  render() {\n    const { preserve_title, preserve_description, preserve_button, cancel_link } = this.protocol?.preservation_locales || {};\n\n    return (\n      <div class=\"cancel-discount\">\n        <sc-dashboard-module heading={this.replaceAmount(preserve_title)} style={{ '--sc-dashboard-module-spacing': '2em' }}>\n          <span slot=\"description\">{this.replaceAmount(preserve_description)}</span>\n          <sc-flex justifyContent=\"flex-start\">\n            <sc-button type=\"primary\" onClick={() => this.addDiscount()}>\n              {preserve_button}\n            </sc-button>\n            <sc-button class=\"cancel-discount__abort-link\" type=\"text\" onClick={() => this.scCancel.emit()}>\n              {cancel_link}\n            </sc-button>\n          </sc-flex>\n          {!!this.loading && <sc-block-ui spinner />}\n        </sc-dashboard-module>\n      </div>\n    );\n  }\n}\n"]}