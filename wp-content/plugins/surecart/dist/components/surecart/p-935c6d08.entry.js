import{r as t,c as i,h as o}from"./p-cc7ce8c7.js";import{s as n}from"./p-09484d0e.js";import{i as s}from"./p-d556eec7.js";import{g as e}from"./p-b395feb7.js";import"./p-7ef0f71c.js";const r=":host {\n  display: block;\n}\n\nsc-button {\n  color: var(--sc-color-primary-500);\n}\n\n.coupon-form {\n  position: relative;\n  container-type: inline-size;\n}\n.coupon-form .coupon-button {\n  opacity: 0;\n  visibility: hidden;\n  transform: scale(0.9);\n  transition: all var(--sc-transition-fast) ease;\n}\n.coupon-form .coupon-button-mobile {\n  margin-top: var(--sc-input-label-margin);\n  display: none;\n}\n.coupon-form--has-value .coupon-button {\n  opacity: 1;\n  visibility: visible;\n  transform: scale(1);\n}\n\n@container (max-width: 320px) {\n  .coupon-form .coupon-button {\n    display: none;\n  }\n  .coupon-form .coupon-button-mobile {\n    display: block;\n  }\n}\n.form {\n  opacity: 0;\n  visibility: hidden;\n  height: 0;\n  transform: translateY(5px);\n  transition: opacity var(--sc-transition-medium) ease, transform var(--sc-transition-medium) ease;\n  position: relative;\n  gap: var(--sc-spacing-small);\n}\n\n.coupon-form--is-open .form {\n  opacity: 1;\n  visibility: visible;\n  transform: translateY(0);\n  height: auto;\n  margin: var(--sc-spacing-small) 0;\n}\n.coupon-form--is-open .trigger {\n  display: none;\n}\n\n.trigger {\n  cursor: pointer;\n  font-size: var(--sc-font-size-small);\n  line-height: var(--sc-line-height-dense);\n  color: var(--sc-input-label-color);\n  user-select: none;\n}\n.trigger:hover {\n  text-decoration: underline;\n}\n\n.coupon-form--is-rtl .trigger {\n  text-align: right;\n}";const l=class{constructor(o){t(this,o);this.scApplyCoupon=i(this,"scApplyCoupon",7);this.label=undefined;this.loading=undefined;this.busy=undefined;this.placeholder=undefined;this.error=undefined;this.forceOpen=undefined;this.discount=undefined;this.currency=undefined;this.discountAmount=undefined;this.showInterval=undefined;this.open=undefined;this.collapsed=undefined;this.value=undefined;this.buttonText=undefined}handleOpenChange(t){if(t){setTimeout((()=>this.input.triggerFocus()),50)}}handleDiscountChange(t,i){var o,s,r,l,a,u;if(((o=t===null||t===void 0?void 0:t.promotion)===null||o===void 0?void 0:o.code)===((s=i===null||i===void 0?void 0:i.promotion)===null||s===void 0?void 0:s.code))return;if((l=(r=this===null||this===void 0?void 0:this.discount)===null||r===void 0?void 0:r.promotion)===null||l===void 0?void 0:l.code){const i=wp.i18n.sprintf(wp.i18n.__("Coupon code %1$s added. %2$s applied.","sc-coupon-form"),((a=t===null||t===void 0?void 0:t.promotion)===null||a===void 0?void 0:a.code)||this.input.value||"",e((u=this===null||this===void 0?void 0:this.discount)===null||u===void 0?void 0:u.coupon));n(i,"assertive")}else{const t=wp.i18n.__("Coupon code removed.","sc-coupon-form");n(t,"assertive")}setTimeout((()=>{var t,i;if((i=(t=this===null||this===void 0?void 0:this.discount)===null||t===void 0?void 0:t.promotion)===null||i===void 0?void 0:i.code){this.couponTag.shadowRoot.querySelector("*").focus()}else{this.addCouponTrigger.focus()}}),50)}handleBlur(){if(!this.value){this.open=false;this.error=""}}getHumanReadableDiscount(){var t,i,o;if(((t=this===null||this===void 0?void 0:this.discount)===null||t===void 0?void 0:t.coupon)&&((i=this===null||this===void 0?void 0:this.discount)===null||i===void 0?void 0:i.coupon.percent_off)){return e((o=this===null||this===void 0?void 0:this.discount)===null||o===void 0?void 0:o.coupon)}return""}applyCoupon(){this.scApplyCoupon.emit(this.input.value.toUpperCase())}handleKeyDown(t){if((t===null||t===void 0?void 0:t.code)==="Enter"){this.applyCoupon()}else if((t===null||t===void 0?void 0:t.code)==="Escape"){this.scApplyCoupon.emit(null);this.open=false;n(wp.i18n.__("Coupon code field closed.","surecart"),"assertive")}}translateHumanDiscountWithDuration(t){var i;if(!this.showInterval)return t;const{duration:o,duration_in_months:n}=(i=this.discount)===null||i===void 0?void 0:i.coupon;switch(o){case"once":return`${t} ${wp.i18n.__("once","surecart")}`;case"repeating":const i=wp.i18n.sprintf(wp.i18n._n("%d month","%d months",n,"surecart"),n);return wp.i18n.sprintf(wp.i18n.__("%s for %s","surecart"),t,i);default:return t}}render(){var t,i,e,r,l,a;if(this.loading){return o("sc-skeleton",{style:{width:"120px",display:"inline-block"}})}if((i=(t=this===null||this===void 0?void 0:this.discount)===null||t===void 0?void 0:t.promotion)===null||i===void 0?void 0:i.code){let t=this.getHumanReadableDiscount();return o("sc-line-item",{exportparts:"description:info, price-description:discount, price:amount"},o("span",{slot:"description"},o("div",{part:"discount-label"},wp.i18n.__("Discount","surecart")),o("sc-tag",{exportparts:"base:coupon-tag",type:"success",class:"coupon-tag",clearable:true,onScClear:()=>{this.scApplyCoupon.emit(null);this.open=false},onKeyDown:t=>{if(t.key==="Enter"||t.key==="Escape"){n(wp.i18n.__("Coupon was removed.","surecart"),"assertive");this.scApplyCoupon.emit(null);this.open=false}},ref:t=>this.couponTag=t,role:"button","aria-label":wp.i18n.sprintf(wp.i18n.__("Press enter to remove coupon code %s.","surecart"),((r=(e=this===null||this===void 0?void 0:this.discount)===null||e===void 0?void 0:e.promotion)===null||r===void 0?void 0:r.code)||this.input.value||"")},(a=(l=this===null||this===void 0?void 0:this.discount)===null||l===void 0?void 0:l.promotion)===null||a===void 0?void 0:a.code)),t&&o("span",{class:"coupon-human-discount",slot:"price-description"},this.translateHumanDiscountWithDuration(t)),o("span",{slot:"price"},o("sc-format-number",{type:"currency",currency:this===null||this===void 0?void 0:this.currency,value:this===null||this===void 0?void 0:this.discountAmount})))}return this.collapsed?o("div",{part:"base",class:{"coupon-form":true,"coupon-form--is-open":this.open||this.forceOpen,"coupon-form--has-value":!!this.value,"coupon-form--is-rtl":s()}},o("div",{part:"label",class:"trigger",onMouseDown:()=>{if(this.open){return}this.open=true},onKeyDown:t=>{if(t.key!=="Enter"&&t.key!==" "){return true}if(this.open){return}this.open=true;n(wp.i18n.__("Coupon code field opened. Press Escape button to close it.","surecart"),"assertive")},tabindex:"0",ref:t=>this.addCouponTrigger=t,role:"button"},o("slot",{name:"label"},this.label)),o("div",{class:"form",part:"form"},o("sc-input",{exportparts:"base:input__base, input, form-control:input__form-control",value:this.value,onScInput:t=>this.value=t.target.value,placeholder:this.placeholder,onScBlur:()=>this.handleBlur(),onKeyDown:t=>this.handleKeyDown(t),ref:t=>this.input=t,"aria-label":wp.i18n.__("Add coupon code.","surecart")},o("sc-button",{exportparts:"base:button__base, label:button_label",slot:"suffix",type:"text",loading:this.busy,size:"medium",class:"coupon-button",onClick:()=>this.applyCoupon()},o("slot",null,this.buttonText))),o("sc-button",{exportparts:"base:button__base, label:button_label",type:"primary",outline:true,loading:this.busy,size:"medium",class:"coupon-button-mobile",onClick:()=>this.applyCoupon()},o("slot",null,this.buttonText)),!!this.error&&o("sc-alert",{exportparts:"base:error__base, icon:error__icon, text:error__text, title:error_title, message:error__message",type:"danger",open:true},o("span",{slot:"title"},this.error))),this.loading&&o("sc-block-ui",{exportparts:"base:block-ui, content:block-ui__content"})):o("div",{class:{"coupon-form":true,"coupon-form--has-value":!!this.value,"coupon-form--is-rtl":s()}},o("sc-input",{label:this.label,exportparts:"base:input__base, input, form-control:input__form-control",value:this.value,onScInput:t=>this.value=t.target.value,placeholder:this.placeholder,onScBlur:()=>this.handleBlur(),onKeyDown:t=>this.handleKeyDown(t),ref:t=>this.input=t},o("sc-button",{exportparts:"base:button__base, label:button_label",slot:"suffix",type:"text",loading:this.busy,size:"medium",class:"coupon-button",onClick:()=>this.applyCoupon()},o("slot",null,this.buttonText))),o("sc-button",{exportparts:"base:button__base, label:button_label",type:"primary",outline:true,loading:this.busy,size:"medium",class:"coupon-button-mobile",onClick:()=>this.applyCoupon()},o("slot",null,this.buttonText)),!!this.error&&o("sc-alert",{exportparts:"base:error__base, icon:error__icon, text:error__text, title:error_title, message:error__message",type:"danger",open:true},o("span",{slot:"title"},this.error)))}static get watchers(){return{open:["handleOpenChange"],discount:["handleDiscountChange"]}}};l.style=r;export{l as sc_coupon_form};
//# sourceMappingURL=p-935c6d08.entry.js.map