import{r as t,h as e,a as i}from"./p-cc7ce8c7.js";import{a as s}from"./p-18e45a13.js";import{o as n}from"./p-c2833cb1.js";import{a as o}from"./p-1c2e2695.js";const r=":host{display:block}";const d=class{constructor(e){t(this,e);this.heading=undefined;this.subscription=undefined;this.paymentMethods=undefined;this.error=undefined;this.loading=undefined;this.busy=undefined;this.method=undefined}renderLoading(){return e("sc-card",{noPadding:true},e("sc-stacked-list",null,e("sc-stacked-list-row",{style:{"--columns":"4"},"mobile-size":500},[...Array(4)].map((()=>e("sc-skeleton",{style:{width:"100px",display:"inline-block"}}))))))}renderEmpty(){return e("slot",{name:"empty"},e("sc-card",null,e("sc-empty",{icon:"credit-card"},wp.i18n.__("You do not have any payment methods.","surecart"))))}componentWillLoad(){n(this.el,(()=>{this.getPaymentMethods()}))}async getPaymentMethods(){var t,e,i,s;if((t=this.paymentMethods)===null||t===void 0?void 0:t.length)return;const n=((i=(e=this.subscription)===null||e===void 0?void 0:e.customer)===null||i===void 0?void 0:i.id)||((s=this.subscription)===null||s===void 0?void 0:s.customer);if(!n)return;try{this.loading=true;this.paymentMethods=await this.fetchMethods(n)}catch(t){this.error=(t===null||t===void 0?void 0:t.messsage)||wp.i18n.__("Something went wrong","surecart");console.error(this.error)}finally{this.loading=false}}async fetchMethods(t){var e;return await s({path:o(`surecart/v1/payment_methods`,{expand:["card","customer","billing_agreement","paypal_account","payment_instrument","bank_account"],customer_ids:[t],reusable:true,live_mode:(e=this.subscription)===null||e===void 0?void 0:e.live_mode})})}async deleteMethod(t){const e=confirm(wp.i18n.__("Are you sure you want to remove this payment method?","surecart"));if(!e)return;try{this.busy=true;await s({path:`surecart/v1/payment_methods/${t===null||t===void 0?void 0:t.id}/detach`,method:"PATCH"});this.paymentMethods=this.paymentMethods.filter((e=>e.id!==t.id))}catch(t){this.error=(t===null||t===void 0?void 0:t.messsage)||wp.i18n.__("Something went wrong","surecart");console.error(this.error)}finally{this.busy=false}}async updateMethod(t){var e,i,n,o;const{payment_method:r}=await t.target.getFormJson();if(r===(((i=(e=this.subscription)===null||e===void 0?void 0:e.payment_method)===null||i===void 0?void 0:i.id)||((n=this.subscription)===null||n===void 0?void 0:n.payment_method))){return}try{this.busy=true;this.subscription=await s({path:`surecart/v1/subscriptions/${(o=this.subscription)===null||o===void 0?void 0:o.id}`,method:"PATCH",data:{payment_method:r}})}catch(t){this.error=(t===null||t===void 0?void 0:t.messsage)||wp.i18n.__("Something went wrong","surecart");console.error(this.error)}finally{this.busy=false}}renderContent(){var t,i,s;if(this.loading){return this.renderLoading()}if(!((t=this.paymentMethods)===null||t===void 0?void 0:t.length)){return this.renderEmpty()}return e("sc-form",{onScSubmit:t=>this.updateMethod(t)},e("sc-choices",null,this.renderList()),((i=this.paymentMethods)===null||i===void 0?void 0:i.length)>1?e("sc-button",{type:"primary",submit:true,full:true,size:"large",busy:this.busy,disabled:this.busy},wp.i18n.__("Update Payment Method","surecart")):e("sc-button",{type:"link",full:true,href:o(window.location.href,{action:"create",model:"payment_method",...((s=this.subscription)===null||s===void 0?void 0:s.live_mode)===false?{live_mode:false}:{},success_url:window.location.href})},e("sc-icon",{name:"plus",slot:"prefix"}),wp.i18n.__("Add New","surecart")))}renderList(){return this.paymentMethods.map((t=>{var i,s,n;const o=((s=(i=this.subscription)===null||i===void 0?void 0:i.payment_method)===null||s===void 0?void 0:s.id)||((n=this.subscription)===null||n===void 0?void 0:n.payment_method);const{id:r,card:d,live_mode:a,paypal_account:l}=t;return e("sc-choice",{checked:o===r,name:"payment_method",value:r,required:true},e("sc-flex",{justifyContent:"flex-start","align-items":"center"},e("sc-payment-method",{paymentMethod:t})," ",!a&&e("sc-tag",{type:"warning",size:"small"},wp.i18n.__("Test","surecart"))),e("div",{slot:"description"},!!(d===null||d===void 0?void 0:d.exp_month)&&e("span",null,wp.i18n.__("Exp.","surecart"),d===null||d===void 0?void 0:d.exp_month,"/",d===null||d===void 0?void 0:d.exp_year),!!l&&(l===null||l===void 0?void 0:l.email)),o===r&&e("sc-tag",{type:"info",slot:"price"},wp.i18n.__("Current Payment Method","surecart")))}))}render(){var t,i;return e("sc-dashboard-module",{heading:this.heading||wp.i18n.__("Update Payment Method","surecart"),class:"subscription",error:this.error},((t=this.paymentMethods)===null||t===void 0?void 0:t.length)>1&&e("sc-button",{slot:"end",type:"link",href:o(window.location.href,{action:"create",model:"payment_method",...((i=this.subscription)===null||i===void 0?void 0:i.live_mode)===false?{live_mode:false}:{},success_url:window.location.href})},e("sc-icon",{name:"plus",slot:"prefix"}),wp.i18n.__("Add New","surecart")),this.renderContent(),this.busy&&e("sc-block-ui",{spinner:true}))}get el(){return i(this)}};d.style=r;export{d as sc_subscription_payment_method};
//# sourceMappingURL=p-ff2e66fd.entry.js.map