"use strict";const index=require("./index-00f0fc21.js"),utils=require("./utils-a086ed6e.js"),getQueryArg=require("./get-query-arg-53bf21e2.js"),currency=require("./currency-ba038e2f.js"),addQueryArgs=require("./add-query-args-17c551b6.js"),safeRead=(t,n)=>{try{return JSON.parse(t.getItem(n))}catch{return null}},debounce=t=>{let n=!1;return()=>{n||(n=!0,setTimeout((()=>{t(),n=!1}),0))}},createStorageStore=(t,n,e,o=!1)=>{var i;const d=index.createStore(null!==(i=safeRead(t,n))&&void 0!==i?i:e,((t,n)=>JSON.stringify(t)!==JSON.stringify(n))),u=debounce((()=>t.setItem(n,JSON.stringify(d.state))));return u(),o&&window.addEventListener("storage",(()=>{const e=safeRead(t,n);if(null!==e)for(const t in e)d.set(t,e[t])})),d.use({set:u,reset:u}),d},createLocalStore=(t,n,e=!1)=>createStorageStore(localStorage,t,n,e);function removeQueryArgs(t){const n=t.indexOf("?");if(-1===n)return t;const e=addQueryArgs.getQueryArgs(t),o=t.substr(0,n);for(var i=arguments.length,d=new Array(i>1?i-1:0),u=1;u<i;u++)d[u-1]=arguments[u];d.forEach((t=>delete e[t]));const r=addQueryArgs.buildQueryString(e);return r?o+"?"+r:o}const{checkout:checkout$1}=utils.getSerializedState(),notPersistCart="browser"!==(null==checkout$1?void 0:checkout$1.persist)||!!getQueryArg.getQueryArg(window.location.href,"no_cart"),store=notPersistCart?index.createStore({live:{},test:{}}):createLocalStore("surecart-local-storage",{live:{},test:{}},!0),{state:state$1,onChange:onChange$1,on:on$1,set:set$1,get:get$1,dispose:dispose$1}=store;window.scStore=store;const{checkout:checkout}=utils.getSerializedState(),{state:state,onChange:onChange,on:on,set:set,get:get,dispose:dispose}=index.createStore({formId:null,groupId:null,mode:"live",locks:[],product:null,checkout:null,currencyCode:"usd",abandonedCheckoutEnabled:!0,initialLineItems:[],isCheckoutPage:!1,validateStock:!1,persist:"browser",...checkout},((t,n)=>JSON.stringify(t)!==JSON.stringify(n)));onChange("checkout",(t=>setCheckout(t,state.formId))),on("get",(t=>{if("checkout"===t){const t=getCheckout(state.formId,state.mode);(null==t?void 0:t.id)&&(state.checkout=t)}})),on$1("set",((t,n,e)=>Object.keys(n||{}).forEach((t=>handleCheckoutLineItemChange(n[t],null==e?void 0:e[t])))));const handleCheckoutLineItemChange=(t,n)=>{var e,o;const i=(null===(e=null==t?void 0:t.line_items)||void 0===e?void 0:e.data)||[],d=(null===(o=null==n?void 0:n.line_items)||void 0===o?void 0:o.data)||[];if(i.forEach((t=>{const n=d.find((n=>n.id===t.id));if(!n||(null==n?void 0:n.quantity)<(null==t?void 0:t.quantity)){const e=new CustomEvent("scAddedToCart",{detail:{...t,quantity:t.quantity-((null==n?void 0:n.quantity)||0)},bubbles:!0});document.dispatchEvent(e)}})),d.forEach((t=>{const n=i.find((n=>n.id===t.id));if(!n||(null==t?void 0:t.quantity)>(null==n?void 0:n.quantity)){const e=new CustomEvent("scRemovedFromCart",{detail:{...t,quantity:t.quantity-((null==n?void 0:n.quantity)||0)},bubbles:!0});document.dispatchEvent(e)}})),JSON.stringify(i)!==JSON.stringify(d)){const e=new CustomEvent("scCartUpdated",{detail:[t,n],bubbles:!0});document.dispatchEvent(e)}};on("set",((t,n,e)=>{var o,i,d,u,r;if("checkout"!==t)return;if(null==e?void 0:e.id)return;if(!(null==n?void 0:n.id))return;if(!state.isCheckoutPage)return;const l=new CustomEvent("scCheckoutInitiated",{detail:{transaction_id:n.id,value:currency.maybeConvertAmount(null==n?void 0:n.total_amount,(null==n?void 0:n.currency)||"USD"),currency:(n.currency||"").toUpperCase(),...(null===(i=null===(o=null==n?void 0:n.discount)||void 0===o?void 0:o.promotion)||void 0===i?void 0:i.code)?{coupon:null===(u=null===(d=null==n?void 0:n.discount)||void 0===d?void 0:d.promotion)||void 0===u?void 0:u.code}:{},...(null==n?void 0:n.tax_amount)?{tax:currency.maybeConvertAmount(null==n?void 0:n.tax_amount,(null==n?void 0:n.currency)||"USD")}:{},items:((null===(r=null==n?void 0:n.line_items)||void 0===r?void 0:r.data)||[]).map((t=>{var e,o,i,d,u;return{item_name:(null===(o=null===(e=null==t?void 0:t.price)||void 0===e?void 0:e.product)||void 0===o?void 0:o.name)||"",item_id:null===(d=null===(i=null==t?void 0:t.price)||void 0===i?void 0:i.product)||void 0===d?void 0:d.id,discount:(null==t?void 0:t.discount_amount)?currency.maybeConvertAmount((null==t?void 0:t.discount_amount)||0,(null==n?void 0:n.currency)||"USD"):0,price:currency.maybeConvertAmount((null===(u=null==t?void 0:t.price)||void 0===u?void 0:u.amount)||0,(null==n?void 0:n.currency)||"USD"),quantity:(null==t?void 0:t.quantity)||1}}))},bubbles:!0});document.dispatchEvent(l)})),on("set",((t,n,e)=>{var o,i;if("checkout"!==t)return;if(!(null==n?void 0:n.status)||(null==e?void 0:e.status)===(null==n?void 0:n.status))return;if(!["paid","processing"].includes(n.status))return;const d=new CustomEvent("scOrderPaid",{detail:n,bubbles:!0});document.dispatchEvent(d);const u=new CustomEvent("scCheckoutCompleted",{detail:n,bubbles:!0});document.dispatchEvent(u);const r=((null===(o=null==n?void 0:n.line_items)||void 0===o?void 0:o.data)||[]).filter((t=>{var n;return(null===(n=null==t?void 0:t.price)||void 0===n?void 0:n.trial_duration_days)>0}));if(r.length>0){const t=new CustomEvent("scTrialStarted",{detail:r,bubbles:!0});document.dispatchEvent(t)}const l=((null===(i=null==n?void 0:n.line_items)||void 0===i?void 0:i.data)||[]).filter((t=>{var n;return(null===(n=null==t?void 0:t.price)||void 0===n?void 0:n.recurring_interval_count)>0}));if(l.length>0){const t=new CustomEvent("scSubscriptionStarted",{detail:l,bubbles:!0});document.dispatchEvent(t)}})),window.addEventListener("scAddedToCart",(function(t){var n,e,o,i,d,u,r,l,c;if(!(null===window||void 0===window?void 0:window.dataLayer)&&!(null===window||void 0===window?void 0:window.gtag))return;const a=t.detail;if(!(null===(n=null==a?void 0:a.price)||void 0===n?void 0:n.product))return;const v=[{item_id:null===(o=null===(e=a.price)||void 0===e?void 0:e.product)||void 0===o?void 0:o.id,item_name:null===(d=null===(i=a.price)||void 0===i?void 0:i.product)||void 0===d?void 0:d.name,item_variant:(a.variant_options||[]).join(" / "),price:currency.maybeConvertAmount((null===(u=null==a?void 0:a.price)||void 0===u?void 0:u.amount)||0,(null===(r=a.price)||void 0===r?void 0:r.currency)||"USD"),currency:null===(l=a.price)||void 0===l?void 0:l.currency,quantity:a.quantity,discount:(null==a?void 0:a.discount_amount)?currency.maybeConvertAmount((null==a?void 0:a.discount_amount)||0,(null===(c=a.price)||void 0===c?void 0:c.currency)||"USD"):0}];(null===window||void 0===window?void 0:window.gtag)&&window.gtag("event","add_to_cart",{items:v}),(null===window||void 0===window?void 0:window.dataLayer)&&(window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"add_to_cart",ecommerce:{data:{items:v}}}))})),window.addEventListener("scCheckoutCompleted",(function(t){var n,e,o,i,d;if(!(null===window||void 0===window?void 0:window.dataLayer)&&!(null===window||void 0===window?void 0:window.gtag))return;const u=t.detail,r={transaction_id:null==u?void 0:u.id,value:currency.maybeConvertAmount(null==u?void 0:u.total_amount,(null==u?void 0:u.currency)||"USD"),currency:(u.currency||"").toUpperCase(),...(null===(e=null===(n=null==u?void 0:u.discount)||void 0===n?void 0:n.promotion)||void 0===e?void 0:e.code)?{coupon:null===(i=null===(o=null==u?void 0:u.discount)||void 0===o?void 0:o.promotion)||void 0===i?void 0:i.code}:{},...(null==u?void 0:u.tax_amount)?{tax:currency.maybeConvertAmount(null==u?void 0:u.tax_amount,(null==u?void 0:u.currency)||"USD")}:{},items:((null===(d=null==u?void 0:u.line_items)||void 0===d?void 0:d.data)||[]).map((t=>{var n,e,o,i,d,r,l;return{item_id:null===(e=null===(n=null==t?void 0:t.price)||void 0===n?void 0:n.product)||void 0===e?void 0:e.id,currency:(u.currency||"").toUpperCase(),item_name:(null===(i=null===(o=null==t?void 0:t.price)||void 0===o?void 0:o.product)||void 0===i?void 0:i.name)||"",discount:(null==t?void 0:t.discount_amount)?currency.maybeConvertAmount((null==t?void 0:t.discount_amount)||0,(null===(d=null==t?void 0:t.price)||void 0===d?void 0:d.currency)||"USD"):0,price:currency.maybeConvertAmount((null===(r=null==t?void 0:t.price)||void 0===r?void 0:r.amount)||0,(null===(l=null==t?void 0:t.price)||void 0===l?void 0:l.currency)||"USD"),quantity:(null==t?void 0:t.quantity)||1,item_variant:(t.variant_options||[]).join(" / ")}}))};(null===window||void 0===window?void 0:window.gtag)&&window.gtag("event","purchase",r),(null===window||void 0===window?void 0:window.dataLayer)&&(window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"purchase",ecommerce:r}))})),window.addEventListener("scAddedToCart",(function(t){var n,e,o,i,d,u,r,l;if(!(null===window||void 0===window?void 0:window.fbq))return;const c=t.detail;if(!(null===(n=null==c?void 0:c.price)||void 0===n?void 0:n.product))return;const a=null===(e=null==c?void 0:c.price)||void 0===e?void 0:e.product,v=(null===(i=null===(o=null==a?void 0:a.product_collections)||void 0===o?void 0:o.data)||void 0===i?void 0:i.map((t=>t.name)))||[];window.fbq("track","AddToCart",{...v.length?{content_category:v.join(", ")}:{},content_ids:[a.id],content_name:(null==a?void 0:a.name)+((null===(d=null==c?void 0:c.variant_options)||void 0===d?void 0:d.length)?` - ${null==c?void 0:c.variant_options.join(" / ")}`:""),content_type:"product",contents:[{id:a.id,quantity:c.quantity}],currency:null===(u=null==c?void 0:c.price)||void 0===u?void 0:u.currency,value:currency.maybeConvertAmount((null===(r=null==c?void 0:c.price)||void 0===r?void 0:r.amount)||0,(null===(l=null==c?void 0:c.price)||void 0===l?void 0:l.currency)||"USD")})})),window.addEventListener("scCheckoutInitiated",(function(t){var n,e,o;if(!(null===window||void 0===window?void 0:window.fbq))return;const i=t.detail;window.fbq("track","InitiateCheckout",{content_ids:null===(n=null==i?void 0:i.items)||void 0===n?void 0:n.map((t=>t.item_id)),contents:null===(e=null==i?void 0:i.items)||void 0===e?void 0:e.map((t=>({id:t.item_id,quantity:t.quantity}))),currency:null==i?void 0:i.currency,num_items:null===(o=null==i?void 0:i.items)||void 0===o?void 0:o.length,value:i.value})})),window.addEventListener("scCheckoutCompleted",(function(t){var n,e,o;if(!(null===window||void 0===window?void 0:window.fbq))return;const i=t.detail;window.fbq("track","Purchase",{content_ids:null===(n=null==i?void 0:i.items)||void 0===n?void 0:n.map((t=>t.item_id)),content_name:"Purchase",content_type:"product",contents:null===(e=null==i?void 0:i.items)||void 0===e?void 0:e.map((t=>({id:t.item_id,quantity:t.quantity}))),currency:null==i?void 0:i.currency,num_items:null===(o=null==i?void 0:i.items)||void 0===o?void 0:o.length,value:currency.maybeConvertAmount(null==i?void 0:i.total_amount,(null==i?void 0:i.currency)||"USD")})})),window.addEventListener("scTrialStarted",(function(t){(null===window||void 0===window?void 0:window.fbq)&&t.detail.forEach((t=>{var n,e,o;window.fbq("track","StartTrial",{currency:null===(n=t.price)||void 0===n?void 0:n.currency,value:currency.maybeConvertAmount((null===(e=t.price)||void 0===e?void 0:e.amount)||0,(null===(o=t.price)||void 0===o?void 0:o.currency)||"USD")})}))})),window.addEventListener("scSubscriptionStarted",(function(t){(null===window||void 0===window?void 0:window.fbq)&&t.detail.forEach((t=>{var n,e,o;window.fbq("track","Subscribe",{currency:null===(n=t.price)||void 0===n?void 0:n.currency,value:currency.maybeConvertAmount((null===(e=t.price)||void 0===e?void 0:e.amount)||0,(null===(o=t.price)||void 0===o?void 0:o.currency)||"USD")})}))})),window.addEventListener("scPaymentInfoAdded",(function(t){if(!(null===window||void 0===window?void 0:window.fbq))return;const n=t.detail;window.fbq("track","AddPaymentInfo",{content_category:"Payment Info Added",currency:null==n?void 0:n.currency})}));const getCheckout=(t,n)=>{var e;return(null===(e=store.state[n])||void 0===e?void 0:e[t])||{}},setCheckout=(t,n)=>{const e=(null==t?void 0:t.live_mode)?"live":"test";store.set(e,{...store.state[e],[n]:t}),state.formId===n&&state.mode===e&&(state.checkout=t),"url"===state.persist&&(null==t?void 0:t.id)&&window.history.replaceState({},document.title,addQueryArgs.addQueryArgs(window.location.href,{checkout_id:null==t?void 0:t.id}))},clearCheckout=(t,n)=>{const{[t]:e,...o}=store.state[n];return window.history.replaceState({},document.title,removeQueryArgs(window.location.href,"redirect_status","coupon","line_items","confirm_checkout_id","checkout_id")),store.set(n,o)};exports.clearCheckout=clearCheckout,exports.getCheckout=getCheckout,exports.on=on,exports.onChange=onChange,exports.onChange$1=onChange$1,exports.removeQueryArgs=removeQueryArgs,exports.setCheckout=setCheckout,exports.state=state;